## ‚úÖ **What is a Cluster in Oracle?**

A **cluster** allows multiple tables that share a common column (like a foreign key) to be **stored together physically** on disk.

### üü¢ Why?

To **reduce disk I/O** when you always query tables with joins on that column.

---

## üß† Simple Concept:

Let‚Äôs say:

* You have a `products` table (`p_id`)
* You have an `orders` table with `product_id` (foreign key to `products`)

When you often do:

```sql
SELECT * 
FROM products p
JOIN orders o ON p.p_id = o.product_id;
```

Then a **cluster** can store those rows **together** on disk for better performance.

---

## üß± **Step-by-Step: Create Cluster on `products` and `orders`**

---

### ‚úÖ **1. Create Cluster**

We‚Äôll cluster both tables on the `p_id` column:

```sql
CREATE CLUSTER product_cluster (
    p_id NUMBER(10)
);
```

This creates a **cluster structure** using `p_id` as the key.

---

### ‚úÖ **2. Create Cluster Index**

Every cluster **must have an index** to locate data blocks:

```sql
CREATE INDEX idx_product_cluster
ON CLUSTER product_cluster;
```

---

### ‚úÖ **3. Create `products` Table Inside the Cluster**

```sql
CREATE TABLE products (
    p_id NUMBER(10) PRIMARY KEY,
    p_name VARCHAR2(100),
    price NUMBER(10,2),
    stock NUMBER(10)
)
CLUSTER product_cluster(p_id);
```

> üî∏ The `CLUSTER` clause links this table to the cluster using `p_id`.

---

### ‚úÖ **4. Create `orders` Table Inside the Same Cluster**

```sql
CREATE TABLE orders (
    order_id NUMBER(10) PRIMARY KEY,
    product_id NUMBER(10),
    order_date DATE DEFAULT SYSDATE,
    quantity NUMBER(5),
    FOREIGN KEY (product_id) REFERENCES products(p_id)
)
CLUSTER product_cluster(product_id);
```

---

### üìå Now both tables are **physically stored together** in the same cluster block **based on `p_id/product_id`**.

---

## üîÅ Example: Insert Data

```sql
INSERT INTO products VALUES (101, 'Laptop', 50000, 10);
INSERT INTO orders VALUES (1, 101, SYSDATE, 2);
```

These rows are stored **in the same physical block** (faster access).

---

## ‚ùå Drop Cluster and Tables

### Drop Tables First:

```sql
DROP TABLE orders;
DROP TABLE products;
```

### Then Drop Cluster:

```sql
DROP CLUSTER product_cluster INCLUDING TABLES;
```

---

## ‚úÖ Summary: Why Use a Cluster?

| Benefit                      | Explanation                                     |
| ---------------------------- | ----------------------------------------------- |
| Faster join performance      | Physically stores related rows together         |
| Efficient space usage        | Saves space with shared cluster keys            |
| Useful in read-heavy systems | Especially data warehouses or reporting queries |

> ‚ö†Ô∏è Use **only if** your queries consistently join the clustered tables on the cluster key.

---

## ‚úÖ Recap Commands:

| Step           | Command Example                                   |
| -------------- | ------------------------------------------------- |
| Create Cluster | `CREATE CLUSTER product_cluster(p_id NUMBER);`    |
| Create Index   | `CREATE INDEX ... ON CLUSTER product_cluster;`    |
| Create Table   | `CREATE TABLE ... CLUSTER product_cluster(p_id);` |
| Drop Tables    | `DROP TABLE orders;`                              |
| Drop Cluster   | `DROP CLUSTER product_cluster INCLUDING TABLES;`  |

---

Selecting rows from a **cluster** in Oracle SQL is just like selecting from regular tables ‚Äî there's **no special SELECT syntax** for clusters.

Once the tables are created in the cluster, you query them **normally** using `SELECT` statements.

---

## ‚úÖ Example Cluster Setup Recap

Let‚Äôs say you have the following cluster and tables:

```sql
CREATE CLUSTER product_cluster (
    p_id NUMBER(10)
);

CREATE INDEX idx_product_cluster
ON CLUSTER product_cluster;

CREATE TABLE products (
    p_id NUMBER(10) PRIMARY KEY,
    p_name VARCHAR2(100),
    price NUMBER(10,2),
    stock NUMBER(10)
)
CLUSTER product_cluster(p_id);

CREATE TABLE orders (
    order_id NUMBER(10) PRIMARY KEY,
    product_id NUMBER(10),
    order_date DATE,
    quantity NUMBER(5),
    FOREIGN KEY (product_id) REFERENCES products(p_id)
)
CLUSTER product_cluster(product_id);
```

---

## üîç Selecting Rows from Clustered Tables

You just query the **tables** as usual:

### ‚úÖ Select from one table:

```sql
SELECT * FROM products;
```

```sql
SELECT * FROM orders;
```

### ‚úÖ Select with JOIN (cluster optimization applies here):

```sql
SELECT 
    p.p_id, p.p_name, p.price, 
    o.order_id, o.order_date, o.quantity
FROM 
    products p
JOIN 
    orders o 
ON 
    p.p_id = o.product_id;
```

This is where clustering helps:
Oracle physically stores `products` and `orders` rows together **by `p_id`**, so this join is **very fast** with minimal I/O.

---

## ‚úÖ Querying Cluster Key

You can also query using the **cluster key** directly:

```sql
SELECT * FROM products WHERE p_id = 101;
SELECT * FROM orders WHERE product_id = 101;
```

Again, the advantage is in performance ‚Äî not in syntax. Oracle can locate all related rows **in the same data block** thanks to the **cluster index**.

---

## üß† Summary

| Action                    | Syntax                                          |
| ------------------------- | ----------------------------------------------- |
| Select from cluster table | `SELECT * FROM products;`                       |
| Select related rows       | `JOIN products and orders ON p_id = product_id` |
| Filter on cluster key     | `WHERE p_id = ...` or `product_id = ...`        |
