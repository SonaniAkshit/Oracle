# **📌 Oracle SUBQUERIES**

---

## **1️⃣ What is a Subquery?**

A **subquery** is a query **inside** another SQL statement (like `SELECT`, `INSERT`, `UPDATE`, or `DELETE`).
It is enclosed in parentheses `()` and returns data to the outer query.

📌 Uses:

* Filter results dynamically
* Compare values
* Feed data into `INSERT` or `UPDATE`
* Build reusable query logic

---

## **2️⃣ Types of Subqueries**

1. **Single-row subquery** → returns **1 row**.
2. **Multiple-row subquery** → returns **multiple rows**.
3. **Multiple-column subquery** → returns multiple columns.
4. **Correlated subquery** → refers to a column from the outer query.
5. **Inline view** → subquery in the `FROM` clause.

---

## **3️⃣ Full Syntax**

```sql
-- Inside SELECT
SELECT column_list
FROM table_name
WHERE column operator (SELECT column FROM other_table WHERE condition);

-- Inside INSERT
INSERT INTO table_name (col1, col2)
SELECT col1, col2 FROM other_table WHERE condition;

-- Inside UPDATE
UPDATE table_name
SET column = (SELECT column FROM other_table WHERE condition)
WHERE condition;

-- Inside DELETE
DELETE FROM table_name
WHERE column IN (SELECT column FROM other_table WHERE condition);
```

---

## **4️⃣ Examples**

### **A) Single-Row Subquery**

Find employees who earn **more than the average salary**.

```sql
SELECT first_name, salary
FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```

✅ The subquery returns **1 value** (avg salary).

---

### **B) Multiple-Row Subquery**

Find employees whose department location is **in 'NEW YORK'**.

```sql
SELECT first_name, department_id
FROM employees
WHERE department_id IN (
    SELECT department_id
    FROM departments
    WHERE location_id = 1700
);
```

✅ The subquery returns **multiple values**.

---

### **C) Multiple-Column Subquery**

Find employees with the same job and department as employee `101`.

```sql
SELECT first_name, job_id, department_id
FROM employees
WHERE (job_id, department_id) = (
    SELECT job_id, department_id
    FROM employees
    WHERE employee_id = 101
);
```

---

### **D) Correlated Subquery**

Find employees earning **above the average salary in their department**.

```sql
SELECT first_name, department_id, salary
FROM employees e
WHERE salary > (
    SELECT AVG(salary)
    FROM employees
    WHERE department_id = e.department_id
);
```

✅ The subquery runs **once per outer query row**.

---

### **E) Inline View (Subquery in FROM)**

Get top 3 highest-paid employees.

```sql
SELECT *
FROM (
    SELECT first_name, salary
    FROM employees
    ORDER BY salary DESC
)
WHERE ROWNUM <= 3;
```

---

## **5️⃣ Operators Commonly Used with Subqueries**

| Operator       | Use Case Example                  |
| -------------- | --------------------------------- |
| `=`            | Single-row compare                |
| `IN`           | Match in list of values           |
| `ANY` / `SOME` | Compare with any value returned   |
| `ALL`          | Compare with all values returned  |
| `EXISTS`       | Check if subquery returns rows    |
| `NOT EXISTS`   | Check if subquery returns no rows |

---

## **6️⃣ Performance Tips**

* Use `EXISTS` instead of `IN` for large datasets.
* Avoid correlated subqueries when possible — they can be slow.
* Create indexes on columns used in subquery filtering.
* Use `WITH` clause (common table expressions) for readability.

---